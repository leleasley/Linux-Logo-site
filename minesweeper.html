<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Minesweeper Mega</title>
<style>
  body {
    background-color: #121212;
    color: #fff;
    font-family: monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 0;
  }
  h1 {
    margin: 20px 0 10px 0;
  }
  .hud {
    display: flex;
    justify-content: space-between;
    width: 400px;
    background: #1e1e1e;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    font-size: 18px;
  }
  .hud div {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  select, button {
    background: #222;
    color: #fff;
    border: 1px solid #555;
    padding: 5px 10px;
    border-radius: 5px;
    font-family: monospace;
    cursor: pointer;
  }
  select:hover, button:hover {
    background: #333;
  }
  .board {
    display: grid;
    gap: 2px;
    background: #1e1e1e;
    padding: 5px;
    border-radius: 8px;
  }
  .cell {
    width: 30px;
    height: 30px;
    background: #222;
    border: none;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s, transform 0.1s;
  }
  .cell:active {
    transform: scale(0.95);
  }
  .cell.revealed {
    background: #333;
    cursor: default;
  }
  .cell.flag {
    color: #ff4444;
  }
  .cell.mine {
    background: #a00;
  }
</style>
</head>
<body>

<h1>Minesweeper</h1>

<div class="hud">
  <div>Mines: <span id="mineCount"></span></div>
  <div>Time: <span id="timer">0</span></div>
  <div>
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
      <option value="insane">Insane</option>
    </select>
    <button id="resetBtn">ðŸ˜ƒ</button>
  </div>
</div>

<div class="board" id="board"></div>

<script>
  const boardEl = document.getElementById('board');
  const mineCountEl = document.getElementById('mineCount');
  const timerEl = document.getElementById('timer');
  const resetBtn = document.getElementById('resetBtn');
  const difficultyEl = document.getElementById('difficulty');

  let rows, cols, mines;
  let board = [];
  let revealedCount = 0;
  let mineCount;
  let timer;
  let timeElapsed = 0;
  let gameOver = false;
  let firstClick = true;

  const difficultySettings = {
    easy: { rows: 8, cols: 8, mines: 10 },
    medium: { rows: 12, cols: 12, mines: 20 },
    hard: { rows: 16, cols: 16, mines: 40 },
    insane: { rows: 20, cols: 20, mines: 99 }
  };

  function startGame() {
    const settings = difficultySettings[difficultyEl.value];
    rows = settings.rows;
    cols = settings.cols;
    mines = settings.mines;
    board = [];
    revealedCount = 0;
    mineCount = mines;
    gameOver = false;
    firstClick = true;
    timeElapsed = 0;
    timerEl.textContent = timeElapsed;
    clearInterval(timer);
    mineCountEl.textContent = mineCount;
    boardEl.innerHTML = '';
    boardEl.style.gridTemplateColumns = `repeat(${cols}, 30px)`;

    for (let r = 0; r < rows; r++) {
      board[r] = [];
      for (let c = 0; c < cols; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.row = r;
        cell.dataset.col = c;
        cell.addEventListener('click', handleCellClick);
        cell.addEventListener('contextmenu', handleRightClick);
        // Mobile long-press
        let pressTimer;
        cell.addEventListener('touchstart', (e) => {
          pressTimer = setTimeout(() => {
            handleRightClick(e);
          }, 500);
        });
        cell.addEventListener('touchend', () => clearTimeout(pressTimer));
        boardEl.appendChild(cell);
        board[r][c] = { mine: false, revealed: false, flagged: false, el: cell, count: 0 };
      }
    }
  }

  function placeMines(safeRow, safeCol) {
    let placed = 0;
    while (placed < mines) {
      const r = Math.floor(Math.random() * rows);
      const c = Math.floor(Math.random() * cols);
      if (!board[r][c].mine && !(r === safeRow && c === safeCol)) {
        board[r][c].mine = true;
        placed++;
      }
    }
    // Calculate numbers
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        if (!board[r][c].mine) {
          let count = 0;
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr, nc = c + dc;
              if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && board[nr][nc].mine) {
                count++;
              }
            }
          }
          board[r][c].count = count;
        }
      }
    }
  }

  function handleCellClick(e) {
    if (gameOver) return;
    const r = +this.dataset.row;
    const c = +this.dataset.col;
    if (firstClick) {
      placeMines(r, c);
      startTimer();
      firstClick = false;
    }
    revealCell(r, c);
  }

  function handleRightClick(e) {
    e.preventDefault();
    if (gameOver) return;
    const cell = e.target;
    const r = +cell.dataset.row;
    const c = +cell.dataset.col;
    const data = board[r][c];
    if (data.revealed) return;
    data.flagged = !data.flagged;
    cell.textContent = data.flagged ? 'ðŸš©' : '';
    mineCount += data.flagged ? -1 : 1;
    mineCountEl.textContent = mineCount;
  }

  function revealCell(r, c) {
    const cellData = board[r][c];
    if (cellData.revealed || cellData.flagged) return;
    cellData.revealed = true;
    revealedCount++;
    const cellEl = cellData.el;
    cellEl.classList.add('revealed');

    if (cellData.mine) {
      cellEl.textContent = 'ðŸ’£';
      endGame(false);
      return;
    }

    if (cellData.count > 0) {
      cellEl.textContent = cellData.count;
    } else {
      // Reveal neighbors
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          const nr = r + dr, nc = c + dc;
          if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
            revealCell(nr, nc);
          }
        }
      }
    }

    if (revealedCount === rows * cols - mines) {
      endGame(true);
    }
  }

  function startTimer() {
    timer = setInterval(() => {
      timeElapsed++;
      timerEl.textContent = timeElapsed;
    }, 1000);
  }

  function endGame(win) {
    gameOver = true;
    clearInterval(timer);
    resetBtn.textContent = win ? 'ðŸ˜Ž' : 'ðŸ˜µ';
    if (!win) {
      // Reveal all mines
      board.flat().forEach(cell => {
        if (cell.mine) {
          cell.el.textContent = 'ðŸ’£';
          cell.el.classList.add('mine');
        }
      });
    }
  }

  resetBtn.addEventListener('click', startGame);
  difficultyEl.addEventListener('change', startGame);

  startGame();
</script>

</body>
</html>
