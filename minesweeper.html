<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>üí£ Retro Minesweeper</title>
<style>
  :root {
    --bg: #000;
    --fg: #00fff7;
    --cell-bg: #222;
    --cell-revealed: #444;
    --text-shadow: 0 0 10px var(--fg);
    --danger: #ff0000;
    --success: #00ff00;
  }
  body.light {
    --bg: #fff;
    --fg: #222;
    --cell-bg: #ccc;
    --cell-revealed: #aaa;
    --text-shadow: none;
  }
  body {
    margin: 0;
    font-family: 'Courier New', monospace;
    background: var(--bg);
    color: var(--fg);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
  }
  h1 {
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    margin: 10px 0;
    text-shadow: var(--text-shadow);
  }
  .board {
    display: grid;
    gap: 3px;
    margin: 20px;
    touch-action: none;
  }
  .cell {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: var(--cell-bg);
    border: 2px solid var(--fg);
    cursor: pointer;
    user-select: none;
    font-size: clamp(14px, 2vw, 20px);
    width: var(--cell-size);
    height: var(--cell-size);
    transition: transform 0.15s, background-color 0.2s;
  }
  .cell:hover:not(.revealed):not(.flagged) {
    transform: scale(1.05);
  }
  .cell.revealed { background-color: var(--cell-revealed); }
  .cell.flagged { background-color: #ffcc00; color: #000; }
  .cell.mined { background-color: var(--danger); color: #fff; }
  .game-over { color: var(--danger); animation: shake 0.4s; }
  .win { color: var(--success); animation: fadeIn 0.5s; }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
  }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .controls { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
  button {
    background: none;
    border: 2px solid var(--fg);
    color: var(--fg);
    padding: 8px 16px;
    font-size: 1rem;
    cursor: pointer;
    font-family: inherit;
    transition: transform 0.2s, color 0.2s, border-color 0.2s;
  }
  button:hover {
    color: #ff00c8;
    border-color: #ff00c8;
    transform: scale(1.05);
  }
  .status { margin: 10px 0; }
  .back-link {
    margin-top: 10px;
    cursor: pointer;
    border-bottom: 1px dashed var(--fg);
  }
  .tux { width: 60px; margin-top: 10px; }
  @media (max-width: 600px) {
    :root { --cell-size: 35px; }
  }
  @media (min-width: 601px) {
    :root { --cell-size: 50px; }
  }
</style>
</head>
<body>
<h1>üí£ Retro Minesweeper</h1>
<div id="status" class="status"></div>
<div id="board" class="board" role="grid"></div>
<div class="controls">
  <button onclick="startGame()">Start New Game</button>
  <button onclick="toggleTheme()">Toggle Theme</button>
</div>
<div class="back-link" onclick="location.href='/minigames.html'">‚Üê Back to Arcade</div>
<img src="/assets/tux.svg" alt="Tux Penguin" class="tux" loading="lazy" />

<script>
const rows = 10, cols = 10, mineCount = 15;
let board = [], gameOver = false, revealedCount = 0, flaggedCount = 0;
let winCount = +localStorage.getItem('minesweeperWins') || 0;
const statusEl = document.getElementById('status');

function createBoard() {
  board = Array.from({ length: rows }, () =>
    Array.from({ length: cols }, () => ({
      isMine: false, revealed: false, flagged: false, adjacent: 0
    }))
  );
}
function placeMines() {
  let placed = 0;
  while (placed < mineCount) {
    const r = Math.floor(Math.random()*rows), c = Math.floor(Math.random()*cols);
    if (!board[r][c].isMine) { board[r][c].isMine = true; placed++; }
  }
}
function calcAdj() {
  for (let r=0; r<rows; r++) {
    for (let c=0; c<cols; c++) {
      if (board[r][c].isMine) continue;
      let count = 0;
      for (let dr=-1; dr<=1; dr++) for (let dc=-1; dc<=1; dc++) {
        const nr=r+dr, nc=c+dc;
        if (nr>=0 && nr<rows && nc>=0 && nc<cols && board[nr][nc].isMine) count++;
      }
      board[r][c].adjacent = count;
    }
  }
}
function reveal(r, c) {
  const cell = board[r][c];
  if (gameOver || cell.revealed || cell.flagged) return;
  cell.revealed = true;
  revealedCount++;
  if (cell.isMine) return endGame(false);
  if (cell.adjacent === 0) {
    for (let dr=-1; dr<=1; dr++) for (let dc=-1; dc<=1; dc++) {
      const nr=r+dr, nc=c+dc;
      if (nr>=0 && nr<rows && nc>=0 && nc<cols) reveal(nr, nc);
    }
  }
  if (revealedCount === rows*cols - mineCount) endGame(true);
  updateCell(r, c);
}
function flag(r, c) {
  const cell = board[r][c];
  if (gameOver || cell.revealed) return;
  cell.flagged = !cell.flagged;
  flaggedCount = board.flat().filter(x=>x.flagged).length;
  updateCell(r, c);
  updateStatus();
}
function updateCell(r, c) {
  const el = document.querySelector(`[data-r="${r}"][data-c="${c}"]`);
  const cell = board[r][c];
  el.className = 'cell';
  if (cell.revealed) {
    el.classList.add('revealed');
    el.textContent = cell.isMine ? 'üí£' : (cell.adjacent || '');
    if (cell.isMine) el.classList.add('mined');
  } else if (cell.flagged) {
    el.classList.add('flagged');
    el.textContent = 'üö©';
  } else {
    el.textContent = '';
  }
}
function renderBoard() {
  const boardEl = document.getElementById('board');
  boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
  boardEl.innerHTML = '';
  for (let r=0; r<rows; r++) {
    for (let c=0; c<cols; c++) {
      const cellEl = document.createElement('div');
      cellEl.className = 'cell';
      cellEl.setAttribute('role', 'gridcell');
      cellEl.dataset.r = r; cellEl.dataset.c = c;
      cellEl.onclick = ()=>reveal(r, c);
      cellEl.oncontextmenu = e=>{ e.preventDefault(); flag(r, c); };
      let touchTime;
      cellEl.addEventListener('touchstart', ()=>touchTime=Date.now());
      cellEl.addEventListener('touchend', ()=>{
        Date.now()-touchTime > 400 ? flag(r, c) : reveal(r, c);
      });
      boardEl.appendChild(cellEl);
    }
  }
}
function updateStatus(msg) {
  statusEl.innerHTML = msg ?
    `<p class="${msg.type}">${msg.text}</p>` :
    `Wins: <span>${winCount}</span> | Flags: <span>${flaggedCount}</span>`;
}
function endGame(win) {
  gameOver = true;
  if (win) {
    winCount++;
    localStorage.setItem('minesweeperWins', winCount);
    updateStatus({ type: 'win', text: 'You Win! üéâ' });
  } else {
    updateStatus({ type: 'game-over', text: 'Game Over! üí•' });
  }
}
function startGame() {
  createBoard();
  placeMines();
  calcAdj();
  revealedCount = flaggedCount = 0;
  gameOver = false;
  renderBoard();
  updateStatus();
}
function toggleTheme() {
  document.body.classList.toggle('light');
  localStorage.setItem('darkMode', document.body.classList.contains('light'));
}
window.onload = ()=>{
  if (localStorage.getItem('darkMode')==='true') document.body.classList.add('light');
  startGame();
};
</script>
</body>
</html>
